<!DOCTYPE html>
<html>
    <head>
        <title>Question</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="controlButton.css">
    </head>
    <style>
        #level{
            text-align: center;
            font-size: 40px;
            margin-top: 100px;
        }
        #dialog{
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 150px;
            text-justify: center;
            font-size: 30px;
        }
        #question-card{
            top: 400px;
        }
        #choices-rack{
            display: flex; 
            justify-content: space-evenly;
            margin: 100px;
        }
        .choices{
            font-size: 40px;
            padding-left: 50px;
            padding-right: 50px;
            padding-top: 15px;
            padding-bottom: 15px;
            border: 2px solid rgb(50, 50, 50);
            cursor: pointer;
        }
    </style>
    <body>
        <h1 id="level"></h1>
        <p id="dialog"></p>
        <div id="control-rack">
            <button class="control-button" id="quit" onclick="quit();">ÈÄÄÂá∫ÈÅäÊà≤</button>
            <span><button class="control-button" id="continue" onclick="clickingContinue();">ÁπºÁ∫å</button></span>
        </div> 
        <div id='question-card'></div>
        <script src="questioning.js"></script>
        <script src="controller.js"></script> 
        <script>
            let i = 0;
            let level = 1;
            let questionKey;
            let questionCardHTML = '';
            const contentOfDialogOfLV1 = 'Êñ∞ÂÖµÔºåÂÖà‰æÜÈªûÁ∞°ÂñÆÁöÑÂü∫Á§éÈ°åÔºåË≠âÊòé‰Ω†‰∏çÊòØË™§ÈóñÁöÑÔºÅ';
            const contentOfDialogOfLV2 = 'Âü∫Á§éÁü•Ë≠òÈÄöÈÅéÔºÅ‰Ω†Áç≤Âæó‰∫ÜÈÄ≤ÂÖ•Á•ûËàü‰∏≠ÂøÉÁöÑË®±ÂèØÊ¨ä„ÄÇÊé•‰∏ã‰æÜÁöÑ‰ªªÂãôÊòØÁ¢∫‰øùËºâ‰∫∫È£õËàπËàáÁ©∫ÈñìÁ´ôÁöÑÂÆåÁæéÂ∞çÊé•ÔºåËÄÉÈ©ó‰Ω†Â∞çÊ†∏ÂøÉÊäÄË°ìÁöÑÁêÜËß£ÔºÅ';
            const contentOfDialogOfLV3 = 'ÂæàÂ•ΩÔºå‰Ω†Â∞çËºâ‰∫∫Ëà™Â§©È´îÁ≥ªÂ∑≤Á∂ìÊéåÊè°ÔºÅÁèæÂú®ÊàëÂÄëÈÄ≤ÂÖ•Â´¶Â®•Â∑•Á®ãÔºåÁõÆÊ®ôÊòØÊúàÁêÉÂíåÊ∑±Á©∫„ÄÇÂõûÁ≠îÈÄô‰∫õÈóúÊñºË£úÁµ¶ËàáÊé¢Ê∏¨ÁöÑÈ°åÁõÆÔºÅ';
            const contentOfDialogOfLV4 = 'Èõ¢ÊàêÂäüÂè™Êúâ‰∏ÄÊ≠•‰πãÈÅôÔºÅÊúÄÁµÇÈóúÂç°ÊòØÁ©∫ÈñìÁ´ôÂíåÊú™‰æÜÊäÄË°ì„ÄÇÂõûÁ≠îÈÄô‰∫õÈóúÊñºÈáçÂûãÁôºÂ∞ÑÂíåÊ∑±Á©∫Êé¢Ê∏¨ÁöÑÈõ£È°åÔºå‰Ω†Â∞±ËÉΩÊàêÁÇ∫Ê≠£ÂºèÁöÑËà™Â§©Â∞àÂÆ∂ÔºÅ';
            const body = document.body;
            const title = document.getElementById('level');
            let contentOfDialog;
            const levelTitles = ['üåü Á¨¨‰∏ÄÁ¥öÔºöÊñ∞ÂÖµÂ†±Âà∞ÔºàÁ∞°ÂñÆÔºâ',];
            let questionNum = 0;
            let lengthOfContentOfDialog;
            let is_answered = true;
            let plot_passed = false;
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            function setDialog(){
                title. innerHTML = levelTitles[level - 1];
                switch(level){
                    case 1:
                        contentOfDialog = contentOfDialogOfLV1;
                        break;
                    case 2:
                        contentOfDialog = contentOfDialogOfLV2;
                        break;
                    case 3:
                        contentOfDialog = contentOfDialogOfLV3;
                        break;
                    case 4:
                        contentOfDialog = contentOfDialogOfLV4;
                        break;
                    default:
                        contentOfDialog = '‰Ω†ÁöÑË°®Áèæ‰ª§‰∫∫Âç∞Ë±°Ê∑±ÂàªÔºåÊñ∞ÂÖµ„ÄÇ‰Ω†Â∑≤Á∂ìË≠âÊòé‰∫ÜËá™Â∑±Â∞ç‰∏≠ÂúãËà™Â§©‰∫ãÊ•≠ÁöÑÊ∑±ÂàªÁêÜËß£„ÄÇÈï∑ÂæÅÁÅ´ÁÆ≠Â∑≤Á∂ìÊ∫ñÂÇôÂ∞±Á∑íÔºåÁèæÂú®ÔºåÊ∫ñÂÇôÂ•ΩËøéÊé•‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°ÁôºÂ∞Ñ‰ªªÂãôÔºåÂéªÂæÅÊúçÊòüËæ∞Â§ßÊµ∑ÂêßÔºÅ';
                        break;
                }
                lengthOfContentOfDialog = contentOfDialog.length;
            }
            async function typeDialog(){
                setDialog();
                const blinkinterval = 100; 
                for (i = 0; i < lengthOfContentOfDialog; i++){
                    let blinkTimes = Math.round(Math.random() * 3);
                    for (let t = 0; t < blinkTimes; t++){
                        dialog.innerHTML += '|';
                        await sleep(blinkinterval);
                        dialog.innerHTML = dialog.innerHTML.replace('|', '');
                        await sleep(blinkinterval);
                    }
                    dialog.innerHTML += contentOfDialog[i] + '|';
                    dialog.innerHTML = dialog.innerHTML.replace('|', '');
                }
            }
            function generateQuestionCard(questionKey){
                let symbols = ['A', 'B', 'C', 'D'];
                let options;
                let choices = {};
                console.log(questionCardHTML);
                const questionCard = document.getElementById('question-card');
                questionCard.innerHTML = ``;
                shuttleArray(symbols);
                switch(level){
                    case 1:
                        options = questionsOfLV1[questionKey].incorrect;
                        options.push(questionsOfLV1[questionKey].correct);
                        shuttleArray(options);
                        for (let choiceIndex = 0; choiceIndex < 4; choiceIndex++){
                            choices[symbols[choiceIndex]] = options[choiceIndex];
                        }
                        questionCardHTML = `
                            <div id='question-card'>
                                <h2>ÂïèÈ°å ${questionNum}: ${questionKey}?</h2>
                                <button class='choices'>A. ${choices['A']}</button>
                                <button class='choices'>B. ${choices['B']}</button>
                                <button class='choices'>C. ${choices['C']}</button>
                                <button class='choices'>D. ${choices['D']}</button>
                            </div>`;
                        is_answered = false;
                        break;
                    case 2:
                        if (!plot_passed){
                            dialog.innerHTML = '';
                            contentOfDialog = contentOfDialogOfLV2;
                            lengthOfContentOfDialog = contentOfDialog.length;
                            plot_passed = true;
                            i = 0;
                            typeDialog()
                        }
                        options = questionsOfLV2[questionKey].incorrect;
                        options.push(questionsOfLV2[questionKey].correct);
                        shuttleArray(options);
                        for (let choiceIndex = 0; choiceIndex < 4; choiceIndex++){
                            choices[symbols[choiceIndex]] = options[choiceIndex];
                        }
                        questionCardHTML = `
                            <div id=\"question-card\">
                                <h2>ÂïèÈ°å ${questionNum}: ${questionKey}?</h2>
                                <button class=\"choices\">A. ${choices['A']}</button>
                                <button class=\"choices\">B. ${choices['B']}</button>
                                <button class=\"choices\">C. ${choices['C']}</button>
                                <button class=\"choices\">D. ${choices['D']}</button>
                            </div>`;
                        is_answered = false;
                        break;
                }
                questionCard.innerHTML += questionCardHTML;
            }
            function showQuestion(){
                questionNum += 1;
                questionNumOfInstantLV = questionNum % 5;
                switch(level){
                    case 1:
                        questionKey = questionKeysOfLV1.at(questionNumOfInstantLV - 1);
                        break;
                    case 2:
                        questionKey = questionKeysOfLV2.at(questionNumOfInstantLV - 1);
                        break;
                    case 3:
                        questionKey = questionKeysOfLV3.at(questionNumOfInstantLV - 1);
                        break;
                    case 4:
                        questionKey = questionKeysOfLV4.at(questionNumOfInstantLV - 1);
                        break;
                    default:
                        break;
                }
                generateQuestionCard(questionKey);
                if (questionNumOfInstantLV == 0){
                    level += 1;
                    questionNumOfInstantLV = 0;
                    plot_passed = false;
                }
            }
            function clickingContinue(){
                if (i == 0){
                    typeDialog();
                } else {//if(is_answered){
                    dialog.innerHTML = '';
                    showQuestion();
                } /*else {
                    alert('Ë´ãÂÖàÂõûÁ≠îÁï∂ÂâçÂïèÈ°åÔºÅ');
                }*/
            }
            // main
            typeDialog();
        </script>
    </body>
</html>